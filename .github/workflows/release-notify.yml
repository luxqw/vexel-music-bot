name: Production Release Notify

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    
    steps:
      - name: Send Discord Production Release Notification
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_PROD || secrets.DISCORD_WEBHOOK }}
        run: |
          TAG_NAME="${{ github.event.release.tag_name }}"
          RELEASE_URL="${{ github.event.release.html_url }}"
          REPO_OWNER="${{ github.repository_owner }}"
          
          JSON_PAYLOAD=$(jq -n \
            --arg title "üöÄ New Production Release!" \
            --arg description "**Tag:** `$TAG_NAME`\n**URL:** [View Release]($RELEASE_URL)" \
            --arg url "$RELEASE_URL" \
            --arg color 3066993 \
            --arg footer "Production ‚Ä¢ Release" \
            --arg icon_url "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" \
            --arg timestamp "${{ github.event.release.published_at }}" \
            --arg docker_image "ghcr.io/$REPO_OWNER/vexel-music-bot:$TAG_NAME" \
            '{
              "embeds": [
                {
                  "title": $title,
                  "description": $description,
                  "url": $url,
                  "color": ($color | tonumber),
                  "footer": { "text": $footer, "icon_url": $icon_url },
                  "timestamp": $timestamp,
                  "fields": [
                    {
                      "name": "üê≥ Docker Image",
                      "value": "```\n" + $docker_image + "```",
                      "inline": false
                    }
                  ]
                }
              ]
            }')
          
          curl -H "Content-Type: application/json" \
               -d "$JSON_PAYLOAD" \
               $DISCORD_WEBHOOK_URL
